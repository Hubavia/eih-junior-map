<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EIH Junior Ice Hockey League</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" crossorigin="anonymous" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            display: flex;
            height: 100vh;
            overflow: hidden;
            background: #f5f5f5;
        }
        
        .sidebar {
            width: 380px;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            z-index: 1000;
        }
        
        .header {
            background: #003d7a; /* England Ice Hockey blue */
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: "";
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.05) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
            position: relative;
            z-index: 1;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        .controls {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 2px solid #e74333; /* England Ice Hockey red accent */
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        .control-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
            font-size: 14px;
        }
        
        select, input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            background: white;
        }
        
        select:disabled, input:disabled {
            background: #f0f0f0;
            cursor: not-allowed;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        button:disabled {
            background: #e0e0e0;
            color: #999;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: #003d7a;
            color: white;
            border: 1px solid #003d7a;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: #002d5a;
            border-color: #002d5a;
        }
        
        .btn-secondary {
            background: #e74333;
            color: white;
            border: 1px solid #e74333;
        }
        
        .btn-secondary:hover {
            background: #d63323;
            border-color: #d63323;
        }
        
        .btn-reset:hover {
            background: #5a6268;
        }
        
        .info-panel {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .info-content {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .info-content h3 {
            color: #003d7a;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .info-content p {
            color: #555;
            line-height: 1.6;
            margin-bottom: 8px;
        }
        
        .team-list {
            display: grid;
            gap: 8px;
            margin-top: 10px;
        }
        
        .team-item {
            background: white;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .team-item.clickable {
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .team-item.clickable:hover {
            background: #f0f0f0;
            border-color: #003d7a;
            transform: translateX(5px);
        }
        
        .team-item.highlight-on-map {
            background: #e8f1ff;
            border-color: #003d7a;
            border-width: 2px;
        }
        
        .team-item .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        
        .team-item .dot.north { background: #003d7a; }
        .team-item .dot.south { background: #e74333; }
        .team-item .dot.national { background: #FFD700; }
        
        .map-container {
            flex: 1;
            position: relative;
        }
        
        #map {
            width: 100%;
            height: 100%;
        }
        
        .map-error {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            padding: 40px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .map-error h3 {
            color: #e74c3c;
            margin-bottom: 10px;
        }
        
        .legend {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        
        .legend h4 {
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
            font-size: 13px;
        }
        
        .legend-item .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .autocomplete-dropdown {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
            z-index: 1001;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .autocomplete-item {
            padding: 10px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .autocomplete-item:hover {
            background: #f0f0f0;
        }
        
        .stats {
            background: #e8f1ff;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 13px;
            color: #003d7a;
            border: 1px solid #b3d1ff;
        }
        .custom-marker {
            transition: transform 0.2s;
        }
        
        .custom-marker:hover {
            transform: scale(1.2);
            z-index: 1000 !important;
        }
        
        .leaflet-marker-icon {
            cursor: pointer !important;
        }
        
        .leaflet-tooltip {
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="header">
            <h1>üèí EIH Junior Ice Hockey League</h1>
            <p>2025/26 Season Schedule Explorer</p>
            <p style="font-size: 11px; opacity: 0.7; margin-top: 5px; font-style: italic;">For reference only - Not for operational use - Unofficial</p>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label for="ageGroup">Age Group:</label>
                <select id="ageGroup">
                    <option value="">Select Age Group</option>
                    <option value="U10">Under 10 (U10)</option>
                    <option value="U12">Under 12 (U12)</option>
                    <option value="U14">Under 14 (U14)</option>
                    <option value="U16">Under 16 (U16)</option>
                    <option value="U19">Under 19 (U19)</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="division">Division:</label>
                <select id="division" disabled>
                    <option value="">Select Age Group First</option>
                </select>
            </div>
            
            <div style="margin-top: 15px;">
                <button class="btn-secondary" id="resetView" style="width: 100%; padding: 12px; background: #e74333; color: white; border: none; border-radius: 5px; font-size: 14px; font-weight: 600; cursor: pointer;">
                    üîÑ Reset View / Show All Venues
                </button>
            </div>
        </div>
        
        <div class="info-panel">
            <div class="info-content">
                <h3>Welcome!</h3>
                <p>Select an age group and division to explore the UK Junior Ice Hockey structure.</p>
                <p>Click on any team marker on the map to see detailed information.</p>
                <div class="stats">
                    <strong>Mapped Locations:</strong> 67 team entries<br>
                    <strong>Unique Venues:</strong> 30 ice rinks<br>
                    <strong>Age Groups:</strong> 5 (U10 to U19)<br>
                    <strong>Total Divisions:</strong> 25<br>
                    <strong>Note:</strong> Many venues host multiple teams
                </div>
            </div>
        </div>
    </div>
    
    <div class="map-container">
        <div id="map"></div>
        <div class="legend">
            <h4>Venue Locations</h4>
            <div class="legend-item">
                <div class="dot" style="background: #003d7a;"></div>
                <span>North Venues</span>
            </div>
            <div class="legend-item">
                <div class="dot" style="background: #e74333;"></div>
                <span>South Venues</span>
            </div>
            <div class="legend-item">
                <div class="dot" style="background: #FFD700;"></div>
                <span>Hosts U19 National Division Team</span>
            </div>
        </div>
    </div>
    
    <!-- Leaflet JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js" crossorigin="anonymous"></script>
    
    <script>
        /**
         * EIH Junior Ice Hockey League Interactive Map
         * Author & Owner: Hubert Klupsch
         * Based on official EIH Junior Leagues 2025-2026 v.5 material
         * Created: 2025
         * Version: 1.0
         * 
         * This application is for reference purposes only and is not official.
         * All data is based on EIH Junior Leagues 2025-2026 v.5 documentation.
         */
        
        // Complete data structure
        const hockeyData = {
            clubs: {
                // Peterborough (Planet Ice Peterborough)
                "Peterborough": { lat: 52.5755, lng: -0.2426, city: "Peterborough" },
                "Peterborough 1": { lat: 52.5758, lng: -0.2422, city: "Peterborough" },
                "Peterborough 2": { lat: 52.5757, lng: -0.2424, city: "Peterborough" },
                
                // Chelmsford (Riverside Leisure Centre)
                "Chelmsford": { lat: 51.7355, lng: 0.4685, city: "Chelmsford" },
                "Chelmsford 1": { lat: 51.7357, lng: 0.4687, city: "Chelmsford" },
                "Chelmsford 2": { lat: 51.7353, lng: 0.4683, city: "Chelmsford" },
                
                // Cambridge (Cambridge Ice Arena)
                "Cambridge": { lat: 52.2053, lng: 0.1218, city: "Cambridge" },
                
                // Milton Keynes (Planet Ice Milton Keynes)
                "MK Storm": { lat: 52.0406, lng: -0.7594, city: "Milton Keynes" },
                "MK Storm 1": { lat: 52.0408, lng: -0.7592, city: "Milton Keynes" },
                "MK Storm 2": { lat: 52.0404, lng: -0.7596, city: "Milton Keynes" },
                
                // Romford (Sapphire Ice Rink)
                "Romford": { lat: 51.5755, lng: 0.1821, city: "Romford" },
                "Romford 1": { lat: 51.5757, lng: 0.1823, city: "Romford" },
                "Romford 2": { lat: 51.5753, lng: 0.1819, city: "Romford" },
                
                // Haringey (Alexandra Palace)
                "Haringey": { lat: 51.5947, lng: -0.1198, city: "London (Haringey)" },
                "Haringey 1": { lat: 51.5949, lng: -0.1196, city: "London (Haringey)" },
                "Haringey 2": { lat: 51.5945, lng: -0.1200, city: "London (Haringey)" },
                
                // Leeds (Planet Ice Leeds)
                "Leeds": { lat: 53.7964, lng: -1.5478, city: "Leeds" },
                "Leeds 1": { lat: 53.7966, lng: -1.5476, city: "Leeds" },
                "Leeds 2": { lat: 53.7962, lng: -1.5480, city: "Leeds" },
                "Leeds W": { lat: 53.7968, lng: -1.5474, city: "Leeds" },
                "Leeds B": { lat: 53.7960, lng: -1.5482, city: "Leeds" },
                
                // Whitley Bay (Whitley Bay Ice Rink)
                "Whitley Bay": { lat: 55.0386, lng: -1.4414, city: "Whitley Bay" },
                "Whitley": { lat: 55.0388, lng: -1.4412, city: "Whitley Bay" },
                
                // Billingham (Billingham Forum)
                "Billingham": { lat: 54.6058, lng: -1.2759, city: "Billingham" },
                "Billingham 2": { lat: 54.6060, lng: -1.2757, city: "Billingham" },
                
                // Kingston (Kingston Ice Rink) - Hull area
                "Kingston": { lat: 53.7676, lng: -0.3274, city: "Kingston upon Hull" },
                
                // Sheffield (iceSheffield)
                "Sheffield": { lat: 53.3811, lng: -1.4701, city: "Sheffield" },
                "Sheffield 1": { lat: 53.3813, lng: -1.4699, city: "Sheffield" },
                "Sheffield 2": { lat: 53.3809, lng: -1.4703, city: "Sheffield" },
                
                // Solihull (Planet Ice Solihull)
                "Solihull": { lat: 52.4118, lng: -1.7697, city: "Solihull" },
                "Solihull 1": { lat: 52.4120, lng: -1.7695, city: "Solihull" },
                "Solihull 2": { lat: 52.4116, lng: -1.7699, city: "Solihull" },
                
                // Telford (Telford Ice Rink)
                "Telford": { lat: 52.6783, lng: -2.4447, city: "Telford" },
                
                // Coventry (Planet Ice Coventry)
                "Coventry": { lat: 52.4068, lng: -1.5197, city: "Coventry" },
                
                // Manchester (Planet Ice Altrincham)
                "Manchester": { lat: 53.3877, lng: -2.3527, city: "Manchester (Altrincham)" },
                "Manchester 1": { lat: 53.3879, lng: -2.3525, city: "Manchester (Altrincham)" },
                "Manchester 2": { lat: 53.3875, lng: -2.3529, city: "Manchester (Altrincham)" },
                
                // Lancashire (Blackburn Arena)
                "Lancashire": { lat: 53.7480, lng: -2.4904, city: "Blackburn, Lancashire" },
                
                // Widnes (Widnes Ice Rink)
                "Widnes": { lat: 53.3670, lng: -2.7280, city: "Widnes" },
                "Widnes 1": { lat: 53.3672, lng: -2.7278, city: "Widnes" },
                "Widnes 2": { lat: 53.3668, lng: -2.7282, city: "Widnes" },
                
                // Deeside (Deeside Leisure Centre)
                "Deeside": { lat: 53.2167, lng: -3.0167, city: "Deeside" },
                "Deeside 1": { lat: 53.2169, lng: -3.0165, city: "Deeside" },
                "Deeside 2": { lat: 53.2165, lng: -3.0169, city: "Deeside" },
                
                // Nottingham (National Ice Centre)
                "Nottingham": { lat: 52.9548, lng: -1.1581, city: "Nottingham" },
                "Nottingham 1": { lat: 52.9550, lng: -1.1579, city: "Nottingham" },
                "Nottingham 2": { lat: 52.9546, lng: -1.1583, city: "Nottingham" },
                
                // Bradford (Bradford Ice Arena)
                "Bradford": { lat: 53.7960, lng: -1.7594, city: "Bradford" },
                
                // Bristol (Planet Ice Bristol - Cribbs Causeway)
                "Bristol": { lat: 51.5282, lng: -2.6094, city: "Bristol" },
                
                // Swindon (Swindon Ice Rink)
                "Swindon": { lat: 51.5558, lng: -1.7797, city: "Swindon" },
                "Swindon 1": { lat: 51.5560, lng: -1.7795, city: "Swindon" },
                "Swindon 2": { lat: 51.5556, lng: -1.7799, city: "Swindon" },
                
                // Cardiff (Ice Arena Wales)
                "Cardiff": { lat: 51.4816, lng: -3.1791, city: "Cardiff" },
                "Cardiff 1": { lat: 51.4818, lng: -3.1789, city: "Cardiff" },
                "Cardiff 2": { lat: 51.4814, lng: -3.1793, city: "Cardiff" },
                
                // Oxford (Oxford Ice Rink)
                "Oxford": { lat: 51.7520, lng: -1.2577, city: "Oxford" },
                
                // Slough (Slough Ice Arena)
                "Slough": { lat: 51.5074, lng: -0.5950, city: "Slough" },
                "Slough 1": { lat: 51.5076, lng: -0.5948, city: "Slough" },
                "Slough 2": { lat: 51.5072, lng: -0.5952, city: "Slough" },
                
                // Invicta (Gillingham Ice Bowl)
                "Invicta": { lat: 51.3881, lng: 0.5477, city: "Gillingham (Kent)" },
                "Invicta 1": { lat: 51.3883, lng: 0.5479, city: "Gillingham (Kent)" },
                "Invicta 2": { lat: 51.3879, lng: 0.5475, city: "Gillingham (Kent)" },
                
                // Streatham (Streatham Ice Arena)
                "Streatham": { lat: 51.4321, lng: -0.1215, city: "London (Streatham)" },
                "Streatham 2": { lat: 51.4319, lng: -0.1217, city: "London (Streatham)" },
                
                // Guildford (Guildford Spectrum)
                "Guildford": { lat: 51.2362, lng: -0.5704, city: "Guildford" },
                
                // Solent (Southampton) - Assuming Gosport Ice Rink
                "Solent": { lat: 50.7947, lng: -1.1287, city: "Gosport/Southampton" },
                
                // Sutton (Sutton Ice Rink)
                "Sutton": { lat: 51.3656, lng: -0.1942, city: "Sutton" }
            },
            
            divisions: {
                "U10": {
                    "U10 South (East)": {
                        teams: ["Peterborough", "Chelmsford", "Cambridge", "MK Storm", "Romford 2", "Haringey 2"],
                        type: "south"
                    },
                    "U10 North (North East)": {
                        teams: ["Whitley Bay", "Leeds", "Billingham", "Kingston"],
                        type: "north"
                    },
                    "U10 North (South)": {
                        teams: ["Sheffield 2", "Solihull", "Telford", "Coventry"],
                        type: "north"
                    },
                    "U10 North (North West)": {
                        teams: ["Manchester", "Lancashire", "Widnes", "Deeside"],
                        type: "north"
                    },
                    "U10 North (Central)": {
                        teams: ["Manchester 2", "Nottingham", "Sheffield", "Bradford"],
                        type: "north"
                    },
                    "U10 South (West)": {
                        teams: ["Bristol", "Swindon", "Cardiff", "Oxford", "Slough 2"],
                        type: "south"
                    },
                    "U10 South (London East)": {
                        teams: ["Peterborough 2", "Romford", "Haringey", "Invicta", "Chelmsford 2", "Streatham 2"],
                        type: "south"
                    },
                    "U10 South (Central South)": {
                        teams: ["Slough", "Guildford", "Streatham", "Solent"],
                        type: "south"
                    }
                },
                "U12": {
                    "U12N1": {
                        teams: ["Billingham", "Bradford", "Kingston", "Leeds W", "Leeds B", "Manchester", "Nottingham 1", "Sheffield 1", "Solihull", "Widnes"],
                        type: "north",
                        games: "18 games (1 home/1 away)"
                    },
                    "U12N2": {
                        teams: ["Billingham 2", "Lancashire", "Coventry", "Deeside", "Nottingham 2", "Sheffield 2", "Solihull 2", "Telford", "Whitley Bay"],
                        type: "north",
                        games: "16 games (1 home/1 away)"
                    },
                    "U12S1": {
                        teams: ["Cardiff 1", "Chelmsford 1", "Guildford", "Haringey", "Invicta", "Peterborough", "Slough 1", "Streatham", "Swindon"],
                        type: "south",
                        games: "16 games (1 home/1 away)"
                    },
                    "U12S2": {
                        teams: ["Bristol", "Cambridge", "Cardiff 2", "Chelmsford 2", "MK Storm", "Oxford", "Romford", "Solent"],
                        type: "south",
                        games: "14 games (1 home/1 away)"
                    }
                },
                "U14": {
                    "U14N1": {
                        teams: ["Bradford", "Deeside 1", "Kingston", "Leeds 1", "Manchester 1", "Nottingham 1", "Sheffield 1", "Solihull 1", "Whitley", "Widnes 1"],
                        type: "north",
                        games: "18 games (1 home/1 away)"
                    },
                    "U14N2 (East)": {
                        teams: ["Billingham", "Coventry", "Leeds 2", "Nottingham 2", "Sheffield 2", "Sutton"],
                        type: "north",
                        games: "20 games (2 home/2 away)"
                    },
                    "U14N2 (West)": {
                        teams: ["Lancashire", "Deeside 2", "Manchester 2", "Solihull 2", "Telford", "Widnes 2"],
                        type: "north",
                        games: "20 games (2 home/2 away)"
                    },
                    "U14S1": {
                        teams: ["Cardiff", "Chelmsford", "Guildford", "Haringey 1", "Invicta 1", "Peterborough 1", "Slough 1", "Streatham", "Swindon 1"],
                        type: "south",
                        games: "16 games (1 home/1 away)"
                    },
                    "U14S2": {
                        teams: ["Cambridge", "Haringey 2", "Invicta 2", "MK Storm", "Peterborough 2", "Romford", "Bristol", "Oxford", "Slough 2", "Solent", "Swindon 2"],
                        type: "south",
                        games: "20 games (1 home/1 away)"
                    }
                },
                "U16": {
                    "U16N1": {
                        teams: ["Billingham", "Bradford", "Deeside", "Kingston", "Leeds 1", "Manchester", "Nottingham 1", "Sheffield 1", "Solihull 1", "Whitley Bay"],
                        type: "north",
                        games: "18 games (1 home/1 away)"
                    },
                    "U16N2": {
                        teams: ["Lancashire", "Coventry", "Leeds 2", "Nottingham 2", "Sheffield 2", "Solihull 2", "Sutton", "Telford", "Widnes"],
                        type: "north",
                        games: "16 games (1 home/1 away)"
                    },
                    "U16S1": {
                        teams: ["Cardiff", "Chelmsford", "Guildford", "Haringey 1", "Invicta 1", "MK Storm 1", "Streatham", "Peterborough", "Romford 1", "Slough", "Swindon 1"],
                        type: "south",
                        games: "20 games (1 home/1 away)"
                    },
                    "U16S2": {
                        teams: ["Bristol", "Cambridge", "Haringey 2", "Invicta 2", "MK Storm 2", "Oxford", "Romford 2", "Solent", "Swindon 2"],
                        type: "south",
                        games: "16 games (1 home/1 away)"
                    }
                },
                "U19": {
                    "U19 National": {
                        teams: ["Nottingham", "Leeds", "Sheffield", "Telford", "Peterborough", "Haringey 1", "Swindon 1", "Slough 1", "Chelmsford", "Guildford"],
                        type: "national",
                        games: "18 games (1 home/1 away) + Playoffs",
                        note: "Top 8 advance to playoffs: QF (1v8, 2v7, 3v6, 4v5), SF, Final"
                    },
                    "U19N1": {
                        teams: ["Kingston", "Whitley", "Widnes", "Manchester", "Bradford", "Solihull 1", "Leeds 2", "Nottingham 2"],
                        type: "north",
                        games: "20 games"
                    },
                    "U19S2": {
                        teams: ["Romford", "Solent", "Invicta 2", "Bristol", "MK Storm 2"],
                        type: "south",
                        games: "16 games (2 home/2 away)"
                    },
                    "U19N2": {
                        teams: ["Coventry", "Widnes 2", "Deeside", "Sheffield 2", "Sutton", "Solihull 2", "Billingham"],
                        type: "north",
                        games: "18 games (3 games vs each)"
                    },
                    "U19S1": {
                        teams: ["Cardiff", "Invicta", "Streatham", "Oxford", "Haringey 2", "MK Storm", "Swindon 2"],
                        type: "south",
                        games: "18 games (3 games vs each)"
                    }
                }
            }
        };

        // Global variables
        let map = null;
        let markers = [];
        let currentMarkers = [];
        
        // Group teams by venue
        function getVenueGroups() {
            const venues = {};
            
            Object.entries(hockeyData.clubs).forEach(([teamName, location]) => {
                // Create a venue key based on city
                const venueKey = location.city;
                
                if (!venues[venueKey]) {
                    venues[venueKey] = {
                        location: location,
                        teams: [],
                        primaryTeam: null
                    };
                }
                
                venues[venueKey].teams.push(teamName);
                
                // Set primary team (base name without numbers)
                if (!venues[venueKey].primaryTeam || 
                    teamName.length < venues[venueKey].primaryTeam.length ||
                    !teamName.match(/\d/)) {
                    venues[venueKey].primaryTeam = teamName;
                }
            });
            
            return venues;
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üèí EIH Junior Ice Hockey League - Starting...');
            console.log('‚úÖ Data loaded -', Object.keys(hockeyData.clubs).length, 'clubs,', Object.keys(hockeyData.divisions).length, 'age groups');
            
            // Initialize the application
            initializeApp();
        });

        function initializeApp() {
            console.log('üöÄ Starting application...');
            
            // Initialize map
            initializeMap();
            
            // Set up event listeners
            setupEventListeners();
            
            // Show all venues initially
            if (map) {
                showAllVenues();
            }
            
            console.log('‚úÖ Application ready!');
        }

        function initializeMap() {
            console.log('üó∫Ô∏è Initializing map...');
            
            try {
                // Create map centered on UK
                map = L.map('map').setView([53.5, -2.0], 6);
                
                // Add tile layer
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors',
                    maxZoom: 19
                }).addTo(map);
                
                console.log('‚úÖ Map ready!');
                
            } catch (error) {
                console.error('‚ùå Map loading failed:', error);
                document.getElementById('map').innerHTML = `
                    <div class="map-error">
                        <h3>‚ö†Ô∏è Map Loading Error</h3>
                        <p>The map couldn't load, but you can still use all the controls to explore divisions!</p>
                    </div>
                `;
            }
        }

        function setupEventListeners() {
            // Age group change
            document.getElementById('ageGroup').addEventListener('change', function(e) {
                const ageGroup = e.target.value;
                console.log('Age group selected:', ageGroup);
                
                // Update divisions dropdown
                updateDivisions(ageGroup);
                
                // Reset division selection
                document.getElementById('division').value = '';
                
                // Update info panel
                if (ageGroup) {
                    showAgeGroupInfo(ageGroup);
                    // Show venues for this age group on the map
                    showAgeGroupVenues(ageGroup);
                } else {
                    // If no age group selected, show all venues
                    showAllVenues();
                }
            });
            
            // Division change - automatically show on map
            document.getElementById('division').addEventListener('change', function(e) {
                const division = e.target.value;
                const ageGroup = document.getElementById('ageGroup').value;
                
                if (division && ageGroup) {
                    // Automatically show division on map
                    showDivisionOnMap(ageGroup, division);
                    showDivisionInfo(ageGroup, division);
                } else if (ageGroup && !division) {
                    // If division cleared but age group still selected, show age group overview
                    showAgeGroupInfo(ageGroup);
                    showAgeGroupVenues(ageGroup);
                }
            });
            
            // Reset view button - does everything
            document.getElementById('resetView').addEventListener('click', function() {
                // Reset all controls
                document.getElementById('ageGroup').value = '';
                document.getElementById('division').value = '';
                document.getElementById('division').disabled = true;
                
                // Show all venues
                showAllVenues();
                
                // Reset info panel to welcome message
                document.querySelector('.info-content').innerHTML = `
                    <h3>Welcome!</h3>
                    <p>Select an age group and division to explore the EIH Junior Ice Hockey League structure.</p>
                    <p>Click on any venue marker on the map to see detailed information.</p>
                    <div class="stats">
                        <strong>Mapped Locations:</strong> 67 team entries<br>
                        <strong>Unique Venues:</strong> 30 ice rinks<br>
                        <strong>Age Groups:</strong> 5 (U10 to U19)<br>
                        <strong>Total Divisions:</strong> 25<br>
                        <strong>Note:</strong> Many venues host multiple teams
                    </div>
                                    `;
            });
        }

        function updateDivisions(ageGroup) {
            const divisionSelect = document.getElementById('division');
            
            // Clear current options
            divisionSelect.innerHTML = '<option value="">Select Division</option>';
            
            if (ageGroup && hockeyData.divisions[ageGroup]) {
                // Enable the division selector
                divisionSelect.disabled = false;
                
                // Get all divisions and sort them (North first, then South)
                const divisions = hockeyData.divisions[ageGroup];
                const divisionEntries = Object.entries(divisions);
                
                // Sort divisions: North/National first, then South
                divisionEntries.sort((a, b) => {
                    const aType = a[1].type;
                    const bType = b[1].type;
                    
                    // Priority: north/national first, then south
                    if (aType === 'north' && bType === 'south') return -1;
                    if (aType === 'south' && bType === 'north') return 1;
                    if (aType === 'national' && bType !== 'national') return -1;
                    if (aType !== 'national' && bType === 'national') return 1;
                    
                    // Within same type, sort alphabetically
                    return a[0].localeCompare(b[0]);
                });
                
                // Add sorted divisions to dropdown
                divisionEntries.forEach(([division, data]) => {
                    const option = document.createElement('option');
                    option.value = division;
                    option.textContent = division;
                    divisionSelect.appendChild(option);
                });
            } else {
                divisionSelect.disabled = true;
            }
        }

        function showAllVenues() {
            console.log('Showing all venues...');
            
            if (!map) return;
            
            // Clear existing markers
            clearMarkers();
            
            // Get venue groups with division information
            const venues = getVenueGroupsWithDivisions();
            
            // Add one marker per venue with color coding
            Object.entries(venues).forEach(([venueKey, venueData]) => {
                const { location, uniqueTeamNames, primaryTeam, totalTeams, ageGroups, type, hasNational } = venueData;
                
                // Create label showing actual team count
                const label = `${primaryTeam} (${totalTeams} teams, ${ageGroups.size} age groups)`;
                
                // Determine color based on venue type
                const color = type === 'north' ? '#003d7a' : '#e74333';
                
                const marker = L.marker([location.lat, location.lng], {
                    icon: createIcon(color, hasNational),
                    title: label  // Hover tooltip
                }).addTo(map);
                
                // Create popup content
                const popupContent = `
                    <div style="font-family: Arial, sans-serif;">
                        <h4 style="margin: 0 0 5px 0; color: #003d7a;">${location.city}</h4>
                        <p style="margin: 0 0 5px 0; font-size: 13px; color: #555;">
                            <strong>${totalTeams} teams in ${venueData.divisions.length} divisions across ${ageGroups.size} age groups</strong>
                        </p>
                        <p style="margin: 0 0 3px 0; font-size: 12px; color: #666;">
                            Division: <strong>${type.charAt(0).toUpperCase() + type.slice(1)}</strong>
                            ${hasNational ? ' + National' : ''}
                        </p>
                        <p style="margin: 0; font-size: 12px; color: #666;">Age groups: ${Array.from(ageGroups).join(', ')}</p>
                    </div>`;
                
                marker.bindPopup(popupContent);
                marker.on('click', () => showVenueInfo(venueKey, venueData));
                
                currentMarkers.push(marker);
            });
            
            // Fit map to show all markers
            if (currentMarkers.length > 0) {
                const group = new L.featureGroup(currentMarkers);
                map.fitBounds(group.getBounds().pad(0.1));
            }
            
            // Count total teams across all divisions
            let totalTeamCount = 0;
            Object.values(venues).forEach(v => {
                totalTeamCount += v.divisions.length; // Each division entry is a separate team
            });
            
            const uniqueVenues = Object.keys(venues).length;
            
            document.querySelector('.info-content').innerHTML = `
                <h3>Welcome to EIH Junior Ice Hockey League Explorer</h3>
                <p>Showing all <strong>30 ice rink venues</strong> hosting <strong>191 teams</strong> across the UK.</p>
                <p>Select an age group and division above to explore the league structure, or click on any venue marker to see details.</p>
                <div class="stats">
                    <strong>Unique Venues:</strong> ${uniqueVenues}<br>
                    <strong>Total Teams:</strong> 191<br>
                    <strong>Age Groups:</strong> 5 (U10 to U19)<br>
                    <strong>Total Divisions:</strong> 25<br>
                    <strong>Note:</strong> Venues may host multiple teams across different age groups
                </div>
            `;
        }
        
        // Enhanced venue grouping with division type analysis
        function getVenueGroupsWithDivisions() {
            const venues = {};
            
            // Define which venues are North vs South based on the data
            const northVenues = new Set(['Leeds', 'Sheffield', 'Nottingham', 'Manchester', 'Billingham', 
                'Kingston upon Hull', 'Whitley Bay', 'Bradford', 'Solihull', 'Coventry', 'Widnes', 
                'Deeside', 'Telford', 'Blackburn, Lancashire', 'Sutton', 'Manchester (Altrincham)']);
            
            const nationalDivisionTeams = ["Nottingham", "Leeds", "Sheffield", "Telford", "Peterborough", 
                "Haringey 1", "Swindon 1", "Slough 1", "Chelmsford", "Guildford"];
            
            Object.entries(hockeyData.clubs).forEach(([teamName, location]) => {
                const venueKey = location.city;
                
                if (!venues[venueKey]) {
                    venues[venueKey] = {
                        location: location,
                        uniqueTeamNames: new Set(),
                        primaryTeam: null,
                        totalTeams: 0,
                        ageGroups: new Set(),
                        divisions: [],
                        type: northVenues.has(venueKey) ? 'north' : 'south',
                        hasNational: false
                    };
                }
                
                venues[venueKey].uniqueTeamNames.add(teamName);
                
                // Check if this team plays in national division
                if (nationalDivisionTeams.some(natTeam => teamName.startsWith(natTeam.split(' ')[0]))) {
                    venues[venueKey].hasNational = true;
                }
                
                // Set primary team
                if (!venues[venueKey].primaryTeam || 
                    teamName.length < venues[venueKey].primaryTeam.length ||
                    !teamName.match(/\d/)) {
                    venues[venueKey].primaryTeam = teamName;
                }
            });
            
            // Count actual teams (each division entry is a separate team)
            Object.entries(venues).forEach(([venueKey, venueData]) => {
                venueData.uniqueTeamNames.forEach(teamName => {
                    Object.entries(hockeyData.divisions).forEach(([ageGroup, divisions]) => {
                        Object.entries(divisions).forEach(([divName, div]) => {
                            if (div.teams.includes(teamName)) {
                                venueData.ageGroups.add(ageGroup);
                                venueData.divisions.push({
                                    teamName: teamName,
                                    ageGroup: ageGroup,
                                    division: divName
                                });
                                venueData.totalTeams++; // Each occurrence is a separate team
                            }
                        });
                    });
                });
            });
            
            return venues;
        }

        function showDivisionOnMap(ageGroup, divisionName) {
            if (!map) return;
            
            const division = hockeyData.divisions[ageGroup][divisionName];
            if (!division) return;
            
            // Clear ALL existing markers first
            clearMarkers();
            
            // For division view, show individual teams
            division.teams.forEach(teamName => {
                const location = hockeyData.clubs[teamName];
                if (location) {
                    const color = division.type === 'north' ? '#003d7a' : 
                                 division.type === 'south' ? '#e74333' : '#FFD700';
                    
                    const marker = L.marker([location.lat, location.lng], {
                        icon: createIcon(color),
                        title: teamName  // Show individual team name
                    }).addTo(map);
                    
                    marker.bindPopup(createPopupContent(teamName, location, divisionName));
                    marker.on('click', () => showTeamInfo(teamName));
                    
                    currentMarkers.push(marker);
                }
            });
            
            // Fit map to show all markers in division
            if (currentMarkers.length > 0) {
                const group = new L.featureGroup(currentMarkers);
                map.fitBounds(group.getBounds().pad(0.15));
            }
        }
        
        // Keep the original showTeamInfo for division view
        function showTeamInfo(teamName) {
            const location = hockeyData.clubs[teamName];
            const teamDivisions = [];
            
            // Find all divisions this team plays in
            Object.entries(hockeyData.divisions).forEach(([ageGroup, divisions]) => {
                Object.entries(divisions).forEach(([divName, div]) => {
                    if (div.teams.includes(teamName)) {
                        teamDivisions.push({
                            ageGroup: ageGroup,
                            division: divName,
                            type: div.type
                        });
                    }
                });
            });
            
            const infoContent = document.querySelector('.info-content');
            infoContent.innerHTML = `
                <h3>${teamName}</h3>
                <p><strong>Location:</strong> ${location.city}</p>
                <p><strong>Coordinates:</strong> ${location.lat.toFixed(4)}, ${location.lng.toFixed(4)}</p>
                <p><strong>Plays in ${teamDivisions.length} division(s):</strong></p>
                <p style="font-size: 12px; color: #666; margin-top: 5px;">Click a division below to view it on the map:</p>
                <div class="team-list">
                    ${teamDivisions.map(td => `
                        <div class="team-item clickable" 
                             data-agegroup="${td.ageGroup}" 
                             data-division="${td.division}"
                             onclick="selectDivisionFromTeamInfo('${td.ageGroup}', '${td.division}')">
                            <div class="dot ${td.type}"></div>
                            <span>${td.ageGroup} - ${td.division}</span>
                            <span style="margin-left: auto; color: #3498db;">‚Üí</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function clearMarkers() {
            currentMarkers.forEach(marker => {
                map.removeLayer(marker);
            });
            currentMarkers = [];
        }

        function createIcon(color, hasNational = false) {
            const baseIcon = `<div style="background-color: ${color}; width: 20px; height: 20px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.3);"></div>`;
            
            if (hasNational) {
                // Add yellow ring for national division venues
                return L.divIcon({
                    html: `<div style="position: relative; width: 28px; height: 28px;">
                        <div style="position: absolute; top: 0; left: 0; width: 28px; height: 28px; border-radius: 50%; background-color: #FFD700; opacity: 0.8;"></div>
                        <div style="position: absolute; top: 4px; left: 4px; background-color: ${color}; width: 20px; height: 20px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.3);"></div>
                    </div>`,
                    className: 'custom-marker',
                    iconSize: [28, 28],
                    iconAnchor: [14, 14]
                });
            }
            
            return L.divIcon({
                html: baseIcon,
                className: 'custom-marker',
                iconSize: [20, 20],
                iconAnchor: [10, 10]
            });
        }

        function createPopupContent(teamName, location, division) {
            return `
                <div style="font-family: Arial, sans-serif;">
                    <h4 style="margin: 0 0 5px 0; color: #2c3e50;">${teamName}</h4>
                    <p style="margin: 0; font-size: 13px; color: #555;">
                        <strong>Location:</strong> ${location.city}<br>
                        ${division ? `<strong>Division:</strong> ${division}` : ''}
                    </p>
                </div>
            `;
        }

        function showAgeGroupVenues(ageGroup) {
            if (!map) return;
            
            // Clear existing markers
            clearMarkers();
            
            // Get all venues that have teams in this age group
            const venues = getVenueGroupsWithDivisions();
            const ageGroupVenues = {};
            
            // Filter venues that have teams in the selected age group
            Object.entries(venues).forEach(([venueKey, venueData]) => {
                if (venueData.ageGroups.has(ageGroup)) {
                    ageGroupVenues[venueKey] = venueData;
                }
            });
            
            // Add markers for venues in this age group
            Object.entries(ageGroupVenues).forEach(([venueKey, venueData]) => {
                const { location, type, hasNational } = venueData;
                
                // Count teams for this specific age group
                const ageGroupTeams = venueData.divisions.filter(d => d.ageGroup === ageGroup);
                const teamCount = ageGroupTeams.length;
                
                const label = `${venueData.primaryTeam} (${teamCount} ${ageGroup} team${teamCount > 1 ? 's' : ''})`;
                
                // Determine color based on venue type
                const color = type === 'north' ? '#003d7a' : '#e74333';
                
                const marker = L.marker([location.lat, location.lng], {
                    icon: createIcon(color, hasNational && ageGroup === 'U19'),
                    title: label
                }).addTo(map);
                
                // Create popup content specific to this age group
                const popupContent = `
                    <div style="font-family: Arial, sans-serif;">
                        <h4 style="margin: 0 0 5px 0; color: #003d7a;">${location.city}</h4>
                        <p style="margin: 0 0 5px 0; font-size: 13px; color: #555;">
                            <strong>${teamCount} ${ageGroup} team${teamCount > 1 ? 's' : ''}</strong>
                        </p>
                        <p style="margin: 0; font-size: 12px; color: #666;">
                            Division: <strong>${type.charAt(0).toUpperCase() + type.slice(1)}</strong>
                            ${hasNational && ageGroup === 'U19' ? ' + National' : ''}
                        </p>
                    </div>`;
                
                marker.bindPopup(popupContent);
                marker.on('click', () => showVenueInfo(venueKey, venueData));
                
                currentMarkers.push(marker);
            });
            
            // Fit map to show all markers
            if (currentMarkers.length > 0) {
                const group = new L.featureGroup(currentMarkers);
                map.fitBounds(group.getBounds().pad(0.1));
            }
        }
        
        function showAgeGroupInfo(ageGroup) {
            const divisions = hockeyData.divisions[ageGroup];
            const divisionCount = Object.keys(divisions).length;
            let teamCount = 0;
            
            Object.values(divisions).forEach(div => {
                teamCount += div.teams.length;
            });
            
            // Sort divisions: North/National first, then South
            const divisionEntries = Object.entries(divisions);
            divisionEntries.sort((a, b) => {
                const aType = a[1].type;
                const bType = b[1].type;
                
                if (aType === 'north' && bType === 'south') return -1;
                if (aType === 'south' && bType === 'north') return 1;
                if (aType === 'national' && bType !== 'national') return -1;
                if (aType !== 'national' && bType === 'national') return 1;
                
                return a[0].localeCompare(b[0]);
            });
            
            const infoContent = document.querySelector('.info-content');
            infoContent.innerHTML = `
                <h3>${ageGroup} Overview</h3>
                <p><strong>Divisions:</strong> ${divisionCount}</p>
                <p><strong>Total Teams:</strong> ${teamCount}</p>
                <p style="font-size: 12px; color: #666; margin-top: 5px;">Click a division below to view it:</p>
                <div class="team-list">
                    ${divisionEntries.map(([name, div]) => `
                        <div class="team-item clickable" 
                             onclick="selectDivisionFromOverview('${ageGroup}', '${name}')">
                            <div class="dot ${div.type}"></div>
                            <span>${name} (${div.teams.length} teams)</span>
                            <span style="margin-left: auto; color: #3498db;">‚Üí</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        function selectDivisionFromOverview(ageGroup, division) {
            // Update the division dropdown
            document.getElementById('division').value = division;
            
            // Show the division on map (same as when selecting from dropdown)
            showDivisionOnMap(ageGroup, division);
            
            // Update info panel to show division info
            showDivisionInfo(ageGroup, division);
        }

        function showDivisionInfo(ageGroup, divisionName) {
            const division = hockeyData.divisions[ageGroup][divisionName];
            if (!division) return;
            
            const infoContent = document.querySelector('.info-content');
            infoContent.innerHTML = `
                <h3>${divisionName}</h3>
                <p><strong>Age Group:</strong> ${ageGroup}</p>
                <p><strong>Type:</strong> ${division.type.charAt(0).toUpperCase() + division.type.slice(1)} Division</p>
                ${division.games ? `<p><strong>Format:</strong> ${division.games}</p>` : ''}
                ${division.note ? `<p><strong>Note:</strong> ${division.note}</p>` : ''}
                <p><strong>Teams (${division.teams.length}):</strong></p>
                <div class="team-list">
                    ${division.teams.map(team => {
                        const location = hockeyData.clubs[team];
                        return `
                            <div class="team-item" 
                                 onmouseenter="highlightMarker('${team}')"
                                 onmouseleave="unhighlightMarker('${team}')">
                                <div class="dot ${division.type}"></div>
                                <span><strong>${team}</strong> - ${location ? location.city : 'Location not found'}</span>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function showVenueInfo(venueKey, venueData) {
            const { location, divisions, totalTeams, ageGroups } = venueData;
            
            // Group divisions by age group and team name
            const teamsByAgeGroup = {};
            divisions.forEach(d => {
                if (!teamsByAgeGroup[d.ageGroup]) {
                    teamsByAgeGroup[d.ageGroup] = {};
                }
                if (!teamsByAgeGroup[d.ageGroup][d.teamName]) {
                    teamsByAgeGroup[d.ageGroup][d.teamName] = [];
                }
                teamsByAgeGroup[d.ageGroup][d.teamName].push(d);
            });
            
            const infoContent = document.querySelector('.info-content');
            infoContent.innerHTML = `
                <h3>${location.city}</h3>
                <p><strong>Total Teams:</strong> ${totalTeams} (across all age groups)</p>
                <p><strong>Coordinates:</strong> ${location.lat.toFixed(4)}, ${location.lng.toFixed(4)}</p>
                
                ${Object.entries(teamsByAgeGroup).map(([ageGroup, teams]) => `
                    <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                        <p style="margin: 0 0 8px 0; font-weight: 600; color: #003d7a;">${ageGroup}</p>
                        <div class="team-list">
                            ${Object.entries(teams).map(([teamName, divs]) => 
                                divs.map(d => `
                                    <div class="team-item clickable" 
                                         onclick="selectDivisionFromTeamInfo('${d.ageGroup}', '${d.division}')">
                                        <div class="dot ${hockeyData.divisions[d.ageGroup][d.division].type}"></div>
                                        <span><strong>${teamName}</strong> - ${d.division}</span>
                                        <span style="margin-left: auto; color: #003d7a;">‚Üí</span>
                                    </div>
                                `).join('')
                            ).join('')}
                        </div>
                    </div>
                `).join('')}
            `;
        }
        
        function selectDivisionFromTeamInfo(ageGroup, division) {
            // Update the dropdowns
            document.getElementById('ageGroup').value = ageGroup;
            updateDivisions(ageGroup);
            
            // Small delay to ensure division dropdown is populated
            setTimeout(() => {
                document.getElementById('division').value = division;
                document.getElementById('showDivision').disabled = false;
                
                // Show the division on map
                showDivisionOnMap(ageGroup, division);
                
                // Update info panel to show division info
                showDivisionInfo(ageGroup, division);
            }, 50);
        }

        function showAutocomplete(searchTerm, ageGroup) {
            const dropdown = document.getElementById('autocompleteDropdown');
            const teamSearch = document.getElementById('teamSearch');
            
            // Get teams that match the search term
            const matchingTeams = [];
            const divisions = hockeyData.divisions[ageGroup];
            
            Object.entries(divisions).forEach(([divName, div]) => {
                div.teams.forEach(team => {
                    if (team.toLowerCase().includes(searchTerm) && !matchingTeams.find(t => t.name === team)) {
                        matchingTeams.push({
                            name: team,
                            division: divName
                        });
                    }
                });
            });
            
            if (matchingTeams.length > 0) {
                dropdown.innerHTML = matchingTeams.map(team => `
                    <div class="autocomplete-item" data-team="${team.name}" data-division="${team.division}">
                        ${team.name} <small style="color: #666;">(${team.division})</small>
                    </div>
                `).join('');
                
                // Position dropdown
                const rect = teamSearch.getBoundingClientRect();
                dropdown.style.top = (rect.bottom + window.scrollY) + 'px';
                dropdown.style.left = rect.left + 'px';
                dropdown.style.width = rect.width + 'px';
                dropdown.style.display = 'block';
                
                // Add click handlers
                dropdown.querySelectorAll('.autocomplete-item').forEach(item => {
                    item.addEventListener('click', function() {
                        const teamName = this.getAttribute('data-team');
                        const divisionName = this.getAttribute('data-division');
                        
                        teamSearch.value = teamName;
                        document.getElementById('division').value = divisionName;
                        document.getElementById('showDivision').disabled = false;
                        
                        showDivisionInfo(ageGroup, divisionName);
                        hideAutocomplete();
                    });
                });
            } else {
                hideAutocomplete();
            }
        }

        function hideAutocomplete() {
            document.getElementById('autocompleteDropdown').style.display = 'none';
        }
        
        // Marker highlighting functions
        function highlightMarker(teamName) {
            if (!map) return;
            
            currentMarkers.forEach(marker => {
                if (marker.options.title === teamName) {
                    // Scale up the marker
                    const icon = marker.getIcon();
                    if (icon && icon.options) {
                        const currentHtml = icon.options.html;
                        // Check if it's a national venue (has nested divs)
                        if (currentHtml.includes('position: relative')) {
                            // National venue - scale the whole container
                            const enlargedHtml = currentHtml
                                .replace('width: 28px; height: 28px;', 'width: 42px; height: 42px;')
                                .replace('width: 28px; height: 28px;', 'width: 42px; height: 42px;')
                                .replace('top: 4px; left: 4px;', 'top: 6px; left: 6px;')
                                .replace('width: 20px; height: 20px;', 'width: 30px; height: 30px;');
                            
                            marker.setIcon(L.divIcon({
                                html: enlargedHtml,
                                className: 'custom-marker',
                                iconSize: [42, 42],
                                iconAnchor: [21, 21]
                            }));
                        } else {
                            // Regular venue
                            const enlargedHtml = currentHtml
                                .replace('width: 20px; height: 20px;', 'width: 35px; height: 35px;')
                                .replace('border: 2px solid white;', 'border: 3px solid white;');
                            
                            marker.setIcon(L.divIcon({
                                html: enlargedHtml,
                                className: 'custom-marker',
                                iconSize: [35, 35],
                                iconAnchor: [17.5, 17.5]
                            }));
                        }
                        marker.setZIndexOffset(1000);
                    }
                }
            });
        }
        
        function unhighlightMarker(teamName) {
            if (!map) return;
            
            currentMarkers.forEach(marker => {
                if (marker.options.title === teamName) {
                    // Reset marker to original size
                    const icon = marker.getIcon();
                    if (icon && icon.options) {
                        const currentHtml = icon.options.html;
                        
                        // Restore to original size based on type
                        if (currentHtml.includes('position: relative')) {
                            // National venue - restore nested structure
                            const restoredHtml = currentHtml
                                .replace('width: 42px; height: 42px;', 'width: 28px; height: 28px;')
                                .replace('width: 42px; height: 42px;', 'width: 28px; height: 28px;')
                                .replace('top: 6px; left: 6px;', 'top: 4px; left: 4px;')
                                .replace('width: 30px; height: 30px;', 'width: 20px; height: 20px;');
                            
                            marker.setIcon(L.divIcon({
                                html: restoredHtml,
                                className: 'custom-marker',
                                iconSize: [28, 28],
                                iconAnchor: [14, 14]
                            }));
                        } else {
                            // Regular venue
                            const restoredHtml = currentHtml
                                .replace('width: 35px; height: 35px;', 'width: 20px; height: 20px;')
                                .replace('border: 3px solid white;', 'border: 2px solid white;');
                            
                            marker.setIcon(L.divIcon({
                                html: restoredHtml,
                                className: 'custom-marker',
                                iconSize: [20, 20],
                                iconAnchor: [10, 10]
                            }));
                        }
                        marker.setZIndexOffset(0);
                    }
                }
            });
        }
    </script>
</body>
</html>